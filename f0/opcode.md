# Opcode spec

- ここでは、OSECPUのCPUコードを定義する。
- ベースとなるバックエンド命令セット: http://osecpu.osask.jp/wiki/?page0072
  - ここから、ソフトウエア的にCPUコードに変換して実行する。
  - 変換プログラムはCPUコードで記述し、ROMに格納する。
- 命令フォーマットの詳細については、以下のスプレッドシートに記述している。
  - https://docs.google.com/spreadsheets/d/1Mu7-vil4o_n7MA1vi8nemQ8nVOJB7aya1bV88G011OA/edit?usp=sharing

## 発生する可能性のある例外
- CPUは以下の例外を発生させる可能性がある。
  - 例外が発生した場合、CPUの動作は停止され、例外ポートに例外コードが出力される。
  - 将来的には、例外ハンドラ機能を用意するかもしれないが、現在は存在しない。
  
- #UD: 無効命令例外

## 01: LBSET
### オペランド
- typ: 符号なし整数
- base: 符号なし整数
- count: 符号なし整数

### 動作
- メモリのbase番地を開始点として、typのデータがcount個存在するようなラベルを定義する。

- typに指定可能な値は以下のとおりである。

|typ(Hex)|データ型   |
|--------|---------|
|0x00    |Undefined|
|0x01    |VPtr     |
|0x02    |SINT8    |
|0x03    |UINT8    |
|0x04    |SINT16   |
|0x05    |UINT16   |
|0x06    |SINT32   |
|0x07    |UINT32   |
|0x08    |SINT4    |
|0x09    |UINT4    |
|0x0A    |SINT2    |
|0x0B    |UINT2    |
|0x0C    |SINT1    |
|0x0D    |UINT1    |
|0x3F    |Code     |

- 上記以外の値がtypに指定された場合は無効命令例外(#UD)が発生する。

## 02: LIMM16
### オペランド
- r: 整数レジスタ番号
- imm16: 符号あり整数

### 動作
- imm16をレジスタ幅まで符号拡張して、整数レジスタrに代入する。



## 03: PLIMM
### オペランド
### 動作

## 04: CND
### オペランド
### 動作

## 08: LMEM
### オペランド
### 動作

## 09: SMEM
### オペランド
### 動作

## 0A: PLMEM
### オペランド
### 動作

## 0B: PSMEM
### オペランド
### 動作

## 0E: PADD
### オペランド
### 動作

## 0F: PDIF
### オペランド
### 動作

## 10-12: OR, XOR, AND
### オペランド
### 動作

## 14-15: ADD, SUB
### オペランド
### 動作

## 16: MUL
### オペランド
### 動作

## 18-19: SHL, SAR
### オペランド
### 動作

## 1A-1B: DIV, MOD
### オペランド
### 動作

## 1E: PCP
### オペランド
### 動作

## 20-25: CMP(E|NE|L|GE|LE|G)
### オペランド
### 動作

## 26-27: TST(Z|NZ)
### オペランド
### 動作

## 28-2D: PCMP(E|NE|L|GE|LE|G)
### オペランド
### 動作

## 3C-3D: ENTER, LEAVE
### オペランド
### 動作

## D0: LIMM32
### オペランド
### 動作

## D1: LIMM64
### オペランド
### 動作
